USE MASTER 
GO
IF EXISTS (SELECT NAME FROM SYS.DATABASES WHERE NAME = 'CASE_STUDY') DROP DATABASE CASE_STUDY
-------------------
CREATE DATABASE CASE_STUDY 
GO
---------------------------
USE CASE_STUDY
GO
---------------------------
IF OBJECT_ID ('Employee') IS NOT NULL DROP TABLE Employee
IF OBJECT_ID ('Department') IS NOT NULL DROP TABLE Department
IF OBJECT_ID ('Location') IS NOT NULL DROP TABLE Location
IF OBJECT_ID ('Job') IS NOT NULL DROP TABLE Job
---------------------------------------
CREATE TABLE Location
(
	Location_ID int primary key,
	City varchar (40)
);
GO

INSERT INTO  Location VALUES (122,'New York'),(123,'Dallas'),(124,'Chicago'),(167, 'Boston')
GO

CREATE TABLE Job
(
	Job_ID int primary key,
	Designation varchar (30) not null
);
GO

INSERT INTO Job VALUES   (667,'Clerk'),(668,'Staff'),(669,'Analyst'),
						(670,'SalesPerson'),(671,'Manager'),(672,'President')

GO

CREATE TABLE Department
(
	Dep_ID int primary key,
	Dep_Name varchar(40),
	Location_ID int constraint FK_Location_Dep_Location_ID Foreign key references Location (Location_ID)
);
GO

INSERT INTO Department VALUES (10, 'Accounting', 122),(20, 'Sales', 124),
                             (30, 'Research', 123),(40, 'Operations', 167)  
GO

CREATE TABLE Employee
(
	Employee_Id INT PRIMARY KEY,
	Last_Name VARCHAR(50) NOT NULL,
	First_Name VARCHAR(50) NOT NULL,
	Middle_Name CHAR(10) NOT NULL,
	Job_Id INT CONSTRAINT FK_JOB_EMPLOYEE_JOB_ID FOREIGN KEY REFERENCES JOB(Job_Id),
	Manager_Id INT CONSTRAINT FK_EMPLOYEE_EMP_ID FOREIGN KEY REFERENCES EMPLOYEE(Employee_id),
	Hire_Date Date NOT NULL,
	Salary Money NOT NULL,
	Comm MONEY NULL,
	Dep_Id INT CONSTRAINT FK_DEP_EMP_DEP_ID FOREIGN KEY REFERENCES DEPARTMENT(Dep_Id)

);
GO
INSERT INTO Employee VALUES (7369,'SMITH','JOHN','Q',667,7521,'17-DEC-84',800,NULL,20),
							(7499,'ALLEN','KEVIN','J',670,NULL,'20-FEB-85',1600,300,30),
							(7505,'DOYLE','JEAN','K',671,7499,'04-APR-85',2850,NULL,30),
							(7506,'DENNIS','LYNN','S',671,7499,'15-MAY-85',2750,NULL,30),
							(7507,'BAKER','LESLIE','D',671,7369,'10-JUN-85',2200,NULL,40),
							(7521,'WARK','CYNTHIA','D',670,7506,'22-FEB-85',1250,500,30)

GO
----------------------SOLUTIONS---------------------
/*SIMPLE QUERIES*/

--1. list all the employee details
SELECT * FROM Employee
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--2.list all the department details
SELECT * FROM Department
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--3. list all job details
SELECT * FROM Job
667	Clerk
668	Staff
669	Analyst
670	SalesPerson
671	Manager
672	President

--4.list all the locations
SELECT * FROM LOCATION
122	New York
123	Dallas
124	Chicago
167	Boston

--5. list out the first name,last name, salary, commission, for all emp
SELECT [Last_Name],[First_Name],[Salary],[Comm]
FROM Employee
SMITH	JOHN	800.00	NULL
ALLEN	KEVIN	1600.00	300.00
DOYLE	JEAN	2850.00	NULL
DENNIS	LYNN	2750.00	NULL
BAKER	LESLIE	2200.00	NULL
WARK	CYNTHIA	1250.00	500.00

--6. LIST OUT EMPLOYEEID,LASTNAME,DEPARTMENTID FOR ALL EMPLOYEES AND
 --ALIAS EMPLOYEEID AS "ID OF THE EMPLOYEE",LAST NAME AS "NAME OF THE EMPLOYEE",
--DEPARTMENTID AS "DEP_ID".
SELECT [Employee_Id],[Last_Name], [Dep_Id] AS [ID OF THE EMPLOYEE], [Last_Name] AS [NAME OF THE EMPLOYEE], [Dep_Id] AS [DEP_ID]
FROM [dbo].[Employee]
7369	SMITH	20	SMITH	20
7499	ALLEN	30	ALLEN	30
7505	DOYLE	30	DOYLE	30
7506	DENNIS	30	DENNIS	30
7507	BAKER	40	BAKER	40
7521	WARK	30	WARK	30

--7. LIST OUT THE EMPLOYEES ANNUAL SALARY WITH THEIR NAMES ONLY. 
SELECT [Last_Name], [First_Name], [Middle_Name], [Salary]
FROM [dbo].[Employee]
SMITH	JOHN	Q         	800.00
ALLEN	KEVIN	J         	1600.00
DOYLE	JEAN	K         	2850.00
DENNIS	LYNN	S         	2750.00
BAKER	LESLIE	D         	2200.00
WARK	CYNTHIA	D         	1250.00

/*WHERE CONDITION*/
--1. LIST THE DETAILS ABOUT "SMITH"
SELECT * FROM [dbo].[Employee] WHERE [Last_Name] = 'SMITH'
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--2. LIST OUT THE EMPLOYEES WHO ARE WORKING IN DEPARTMENT 20.
SELECT * FROM [dbo].[Employee] WHERE [Dep_Id] = '20'
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--3. LIST OUT THE EMPLOYEES WHO ARE EARNING SALARY BETWEEN 3000 AND 4500.
SELECT * FROM [dbo].[Employee] WHERE [Salary] BETWEEN 3000 AND 4500
SELECT * FROM [dbo].[Employee]
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--4. LIST OUT THE EMPLOYEES WHO ARE WORKING IN DEPARTMENT 10 OR 20.
SELECT * FROM [dbo].[Employee] WHERE [Dep_Id] IN (10, 20) 
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--5. FIND OUT THE EMPLOYEES WHO ARE NOT WORKING IN DEPARTMENT 10 OR 30.
SELECT * FROM [dbo].[Employee] WHERE [Dep_Id] NOT IN (10, 20)
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--6. LIST OUT THE EMPLOYEES WHOSE NAME STARTS WITH 'S'.
SELECT * FROM [dbo].[Employee] WHERE [Last_Name] LIKE 'S%'
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--7. LIST OUT THE EMPLOYEES WHOSE NAME STARTS WITH 'S' AND ENDS WITH 'H'
SELECT * FROM [dbo].[Employee] WHERE [Last_Name] LIKE 'S%H'
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--8. LIST OUT THE EMPLOYEES WHOSE NAME LENGTH IS 4 AND START WITH 'S'.
SELECT * FROM [dbo].[Employee] WHERE [Last_Name] LIKE 'S---'
SELECT * FROM [dbo].[Employee] WHERE LEN([Last_Name]) = 4 AND [Last_Name] LIKE 'S%'

--9. LIST OUT EMPLOYEES WHO ARE WORKING IN DEPARRTMENT 10 AND DRAW THE SALARIES MORE THAN 3500.
SELECT * FROM  [dbo].[Employee] WHERE [Dep_Id] = 10 AND [Salary] >3500

--10. LIST OUT THE EMPLOYEES WHO ARE NOT RECEVING COMMISSION. 
SELECT * FROM [dbo].[Employee] WHERE [Comm] IS NULL
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40

	/*ORDER BY CLAUSE*/
--1. LIST OUT THE EMPLOYEE ID, LAST NAME IN ASCENDING ORDER BASED ON THE EMPLOYEE ID.
 SELECT * FROM [dbo].[Employee]
 ORDER BY [Employee_Id]
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--2. LIST OUT THE EMPLOYEE ID, NAME IN DESCENDING ORDER BASED ON SALARY.
SELECT * FROM [dbo].[Employee]
ORDER BY [Salary] DESC
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20

--3. LIST OUT THE EMPLOYEE DETAILS ACCORDING TO THEIR LAST-NAME IN ASCENDING ORDER AND SALARIES IN DESCENDING ORDER.
SELECT * FROM [dbo].[Employee]
ORDER BY [Last_Name] ASC, [Salary] DESC
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30

--4. LIST OUT THE EMPLOYEE DETAILS ACCORDING TO THEIR LAST-NAME IN ASCENDING ORDER AND
--THEN ON DEPARTMENT_ID IN DESCENDING ORDER. 
SELECT * FROM [dbo].[Employee]
ORDER BY [Last_Name], [Dep_Id] DESC 
7499	ALLEN	KEVIN	J         	670	NULL	1985-02-20	1600.00	300.00	30
7507	BAKER	LESLIE	D         	671	7369	1985-06-10	2200.00	NULL	40
7506	DENNIS	LYNN	S         	671	7499	1985-05-15	2750.00	NULL	30
7505	DOYLE	JEAN	K         	671	7499	1985-04-04	2850.00	NULL	30
7369	SMITH	JOHN	Q         	667	7521	1984-12-17	800.00	NULL	20
7521	WARK	CYNTHIA	D         	670	7506	1985-02-22	1250.00	500.00	30
--

/*GROUP BY AND HAVING*/
--1. HOW MANY EMPLOYEES WHO ARE IN DIFFERENT DEPARTMENTS WISE IN THE ORGANIZATION.
SELECT [Dep_Id], COUNT([Employee_Id]) FROM [dbo].[Employee]
GROUP BY [Dep_Id]
20	1
30	4
40	1

--2. LIST OUT THE DEPARTMENT WISE MAXIMUM SALARY, MINIMUM SALARY, AVERAGEALARY OF THE EMPLOYEES.
SELECT [Dep_Id], MAX([Salary]) AS MAX_SALARY, MIN([Salary]) AS MIN_SALARY, AVG([Salary]) AS AVG_SALARY 
FROM [dbo].[Employee]
GROUP BY [Dep_Id]
20	800.00	800.00	800.00
30	2850.00	1250.00	2112.50
40	2200.00	2200.00	2200.00

--3. LIST OUT JOB WISE MAXIMUM SALARY, MINIMUM SALARY, AVERAGE SALARIES OF THE EMPLOYEES.
SELECT [Job_Id], MAX([Salary]) AS MAX_SALARY, MIN([Salary]) AS MIN_SALARY, AVG([Salary]) AS AVG_SALARY 
FROM [dbo].[Employee]
GROUP BY [Job_Id]
667	800.00	800.00	800.00
670	1600.00	1250.00	1425.00
671	2850.00	2200.00	2600.00

--4. LIST OUT THE NUMBER OF EMPLOYEES JOINED IN EVERY MONTH IN ASCENDING ORDER.
SELECT DATEPART ("MM", [Hire_Date]) [MONTH], COUNT([Employee_Id]) [# OF EMPLOYEES] 
FROM [dbo].[Employee] 
GROUP BY DATEPART ("MM", [Hire_Date])
ORDER BY DATEPART ("MM", [Hire_Date])
2	2
4	1
5	1
6	1
12	1

--5. LIST OUT THE NUMBER OF EMPLOYEES FOR EACH MONTH AND YEAR, IN THE ASCENDING ORDER BASED ON THE YEAR, MONTH.
SELECT DATEPART ("MM",[Hire_Date]) [HIRED_MONTH], DATEPART ("YY",[Hire_Date] ) [HIRED_YEAR], COUNT ([Employee_Id]) AS [# OF EMPLOYEES] 
FROM [dbo].[Employee]
GROUP BY DATEPART ("MM", [Hire_Date]), DATEPART ("YY", [Hire_Date])
ORDER BY  [HIRED_YEAR], [HIRED_MONTH]
12	1984	1
2	1985	2
4	1985	1
5	1985	1
6	1985	1

--6. LIST OUT THE DEPARTMENT ID HAVING ATLEAST FOUR EMPLOYEES.
SELECT [Dep_ID], COUNT([Employee_Id]) AS [# OF EMPLOYEES] FROM [dbo].[Employee] 
GROUP BY [Dep_ID]
HAVING COUNT (Employee_Id) > = 4

30	4

--7. HOW MANY EMPLOYEES JOINED IN JANUARY MONTH.(THERE IS ANOTHER WAY TO DO THIS []BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)
SELECT  COUNT ([Employee_Id]) AS [# OF EMPLOYEES] FROM [dbo].[Employee]
GROUP BY DATENAME ("MM",[Hire_Date])
HAVING DATENAME ("MM", [Hire_Date]) = 'JANUARY'

--8. HOW MANY EMPLOYEES JOINED IN JANUARY OR SEPTEMBER MONTH.(THERE IS ANOTHER WAY TO DO THIS BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)
SELECT COUNT ([Employee_Id]) AS [# OF EMPLOYEES] FROM [dbo].[Employee]
GROUP BY DATENAME ("MM", [Hire_Date])
HAVING DATENAME ("MM", [Hire_Date]) IN ('JANUARY', 'SEPTEMBER')

--9. HOW MANY EMPLOYEES WERE JOINED IN 1985.(THERE IS ANOTHER WAY TO DO THIS BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)
SELECT COUNT ([Employee_Id]) AS [# OF EMPLOYEES] FROM [dbo].[Employee]
GROUP BY DATENAME ("YY", [Hire_Date])
HAVING DATENAME ("YY", [Hire_Date]) = 1985

5

--10. HOW MANY EMPLOYEES WERE JOINED EACH MONTH IN 1985.(THERE IS ANOTHER WAY TO DO THIS BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)
SELECT DATENAME ("MM", [Hire_Date]), MONTHNAME (MONTH,  [Hire_Date] MONTH)
FROM
GROUP BY
ORDER BY


--11. HOW MANY EMPLOYEES WERE JOINED IN MARCH 1985.(THERE IS ANOTHER WAY TO DO THIS BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)



--12. WHICH IS THE DEPARTMENT ID, HAVING GREATER THAN OR EQUAL TO 3 EMPLOYEES JOINED IN APRIL 1985.
--(THERE IS ANOTHER WAY TO DO THIS BUT SINCE HE ASKED USING GROUP BY DO LIKE BELOW)


	   
	   /*JOINS*/

--1. LIST OUT EMPLOYEES WITH THEIR DEPARTMENT NAMES.


--2. DISPLAY EMPLOYEES WITH THEIR DESIGNATIONS.


--3. DISPLAY THE EMPLOYEES WITH THEIR DEPARTMENT NAMES AND REGIONAL GROUPS.


--4. HOW MANY EMPLOYEES WHO ARE WORKING IN DIFFERENT DEPARTMENTS AND DISPLAY WITH DEPARTMENT NAMES.


--5. HOW MANY EMPLOYEES WHO ARE WORKING IN SALES DEPARTMENT.


--6. WHICH IS THE DEPARTMENT HAVING GREATER THAN OR EQUAL TO 5 EMPLOYEES AND DISPLAY THE DEPARTMENT NAMES IN ASCENDING ORDER.


--7. HOW MANY JOBS IN THE ORGANIZATION WITH DESIGNATIONS.




--8. HOW MANY EMPLOYEES ARE WORKING IN "NEW YORK".


--9. DISPLAY THE EMPLOYEE DETAILS WITH SALARY GRADES.


--10. LIST OUT THE NO. OF EMPLOYEES ON GRADE WISE.

	
--11. DISPLAY THE EMPLOYEE SALARY GRADES AND NO. OF EMPLOYEES BETWEEN 2000 TO 5000 RANGE OF SALARY.


--12. DISPLAY THE EMPLOYEE DETAILS WITH THEIR MANAGER NAMES.


--14. SHOW THE NO. OF EMPLOYEES WORKING UNDER EVERY MANAGER.
--SIMPLE ANSWER IS 


--15. DISPLAY EMPLOYEE DETAILS WITH THEIR MANAGER NAMES.
--REPEATING QUESTION

--16. DISPLAY ALL EMPLOYEES IN SALES OR OPERATION DEPARTMENTS.


			/*SET_OPERATORS*/

--1. LIST OUT THE DISTINCT JOBS IN SALES AND ACCOUNTING DEPARTMENTS.


--2. LIST OUT ALL THE JOBS IN SALES AND ACCOUNTING DEPARTMENTS.


--3. LIST OUT THE COMMON JOBS IN RESEARCH AND ACCOUNTING DEPARTMENTS IN ASCENDING ORDER.




			/*SUB_QUERIES*/

--1. DISPLAY THE EMPLOYEES LIST WHO GOT THE MAXIMUM SALARY.


--2. DISPLAY THE EMPLOYEES WHO ARE WORKING IN SALES DEPARTMENT.

--3. DISPLAY THE EMPLOYEES WHO ARE WORKING AS 'CLERCK'.

--4. DISPLAY THE LIST OF EMPLOYEES WHO ARE LIVING IN "NEW YORK".


--5. FIND OUT NO. OF EMPLOYEES WORKING IN "SALES" DEPARTMENT.


--6. UPDATE THE EMPLOYEES SALARIES, WHO ARE WORKING AS CLERK ON THE BASIS OF 10%.



--7. DELETE THE EMPLOYEES WHO ARE WORKING IN ACCOUNTING DEPARTMENT.

--8. DISPLAY THE SECOND HIGHEST SALARY DRAWING EMPLOYEE DETAILS.

	---ASSUGNEMMET USING A COREALTED SUBQUERY GET THE NTH SALARY
	

--9. DISPLAY THE N'TH HIGHEST SALARY DRAWING EMPLOYEE DETAILS.
--WITH CTE_Highest_Salary


--10. LIST OUT THE EMPLOYEES WHO EARN MORE THAN EVERY EMPLOYEE IN DEPARTMENT 30.

--11. LIST OUT THE EMPLOYEES WHO EARN MORE THAN THE LOWEST SALARY IN DEPARTMENT 30.

--12. FIND OUT WHOSE DEPARTMENT HAS NOT EMPLOYEES.

--13. FIND OUT WHICH DEPARTMENT DOES NOT HAVE ANY EMPLOYEES.
--SIMILAR WITH ABOVE

--14. FIND OUT THE EMPLOYEES WHO EARN GREATER THAN THE AVERAGE SALARY FOR THEIR DEPARTMENT.


--derived table 
-- CTE
--temp table, table variables ..




